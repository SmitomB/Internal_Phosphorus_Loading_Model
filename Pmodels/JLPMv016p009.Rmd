---
title: "Jordan Lake Reservoir Model"
subtitle: "Part9: Supplementary Information Plots"
author: "Smitom Borah"
date: "04/30/2023"
output: 
  html_notebook:
    toc : yes
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: lumen

---

<style type="text/css">

h1.title {
  font-size: 38px;
  color: DarkRed;
  text-align: center;
}

h4.author { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkRed;
  text-align: center;
}
h4.date { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}

h3.subtitle { /* Header 4 - and the subtitle, author and data headers use this too  */
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: Red;
  text-align: center;
}

</style>

Time required to run the entire notebook: ~ 2 mins

# Motivation
In this notebook, we create data and visualizations for the supplementary information. 

# Edit log

*No new edit since its creation.*


# Loading packages
Following packages were used in this notebook.

```{r packages, echo=TRUE, message=FALSE, warning=FALSE}
# Clearing the working environment----
cat("\014"); rm(list=ls(all=TRUE)); graphics.off() 

# Start timer
Start_timer9 <- Sys.time()

# Loading the required packages
library(tidyverse)
library(readxl)
library(gridExtra)
library(viridis)
library(imputeTS)
library(zoo)
library(grid)
library(gridtext)
library(patchwork)

# Loading the functions
# suppressMessages(source("Pmodels/functionsJorLak_no19.R"))
suppressMessages(source("Pmodels/JLPMfunv16p001.R"))

# User defined functions
## function to calculate 35 days Moving average
ma35_calc <- function(V) rollmean(V, 35, fill = NA, align = "right")

## function to calculate x days Moving average
ma_calc <- function(V, d) {
  # V : Input vector
  # d : period of moving average
  return(rollmean(V, d, fill = NA, align = "right"))
}

## function to calculate the water temperature
WtrRegMod <- function(X){
  # X <- vector of 35 day moving average air temp
  dat.df <- data.frame(day35_ma = X) 
  return(predict(WtrTemp_r_35d,newdata = dat.df))
}
## Test 
# WtrRegMod(10)

```
Also, let us define basic plot elements before preparing the actual plots.

```{r Basic plot specifications, echo=TRUE, message=FALSE, warning=FALSE}
plot_basics <- ggplot()+
  theme_bw()+
  theme(legend.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.text.align = 0,
        text = element_text(size = 10),
        legend.text = element_text(size = 10, color = "black"),
        axis.title = element_text(size = 10, color = "black"),
        axis.text = element_text(size = 10, color = "black"))
```

# Temperature regression model
## Air temperature
Let us download the air temperature data and tidy it.
```{r Air temp 1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the raw data
RDKDRU_d <- read_xlsx("DataFiles/KRDU_daily_raw_longer.xlsx", sheet = "Worksheet", range = "A13:B13892")

# Cleaning up the data
## Check for number of rows| should be equal to 13879.
nrow(RDKDRU_d)

## Renaming the column
KRDU_d <- RDKDRU_d %>% rename(AvgDailyTemp_C_KRDU = `Average Air Temperature (2m) (C)`)
## Making aeverything numeric
KRDU_d$AvgDailyTemp_C_KRDU <-as.numeric(KRDU_d$AvgDailyTemp_C_KRDU)
### Missing rows
NoData_index_KRDU_d <- which(is.na(KRDU_d[,2])) # should be 169 elements
KRDU_d_MV <- KRDU_d[NoData_index_KRDU_d,]


# # Loading the raw data for KTTA
# KTTA_d1 <- read_xlsx("DataFiles/KTTA_daily_raw_1.xlsx", sheet = "Worksheet", range = "A13:D6953")
# KTTA_d1<- KTTA_d1 %>% 
#   rename(
#     AverageAirTemperature_2m = `Minimum Air Temperature (2m)`,
#     MaximumAirTemperature_2m = ...3,
#     MinimumAirTemperature_2m = ...4,
#     )
# 
# ## Cleaning up the data
# ### Dropping Maximum and minimum values
# KTTA_d1 <- KTTA_d1[, c(1,2)] %>% rename(AvgDailyTemp_C_KTTA = AverageAirTemperature_2m)
# 
# ### Check for number of rows; should be equal to 13149.
# KTTA_d2 <- KRDU_d[seq(1,6209),c(1,2)]
# KTTA_d2 <- KTTA_d2 %>% rename(AvgDailyTemp_C_KTTA = AvgDailyTemp_C_KRDU) 
# KTTA_d2$AvgDailyTemp_C_KTTA <- NA
# KTTA_d1 <- rbind(KTTA_d2,KTTA_d1)
# nrow(KTTA_d1)
# 
# ### Replacing the NA
# KTTA_d1$AvgDailyTemp_C_KTTA <-as.numeric(KTTA_d1$AvgDailyTemp_C_KTTA)
# 
# ### Missing data
# NoData_index_KTTA_d1 <- which(is.na(KTTA_d1[,2]))
# KTTA_d1_MV <- KTTA_d1[NoData_index_KRDU_d,]
# 
# # Loading the raw data for REED
# REED_d1 <- read_xlsx("DataFiles/REED_daily_raw_1.xlsx", sheet = "Worksheet", range = "A13:D8414")
# REED_d1 <- REED_d1 %>% rename(`Average Air Temperature (2m) (C)` = `Average Air Temperature (2m)`)
# REED_d2 <- read_xlsx("DataFiles/REED_daily_raw_2.xlsx", sheet = "Worksheet", range = "A13:D4761")
# 
# REED_d <- rbind(REED_d1,REED_d2)
# 
# ## Cleaning up the data
# ### Check for number of rows| should be equal to 13149.
# nrow(REED_d)
# 
# ### Dropping Maximum and minimum values
# REED_d <- REED_d[, c(1,2)] %>% rename(AvgDailyTemp_C_REED = `Average Air Temperature (2m) (C)`)
# 
# ### Replacing the NA
# REED_d$AvgDailyTemp_C_REED <-as.numeric(REED_d$AvgDailyTemp_C_REED)
# 
# ### Missing rows of KRDU
# NoData_index_REED_d <- which(is.na(REED_d[,2]))
# REED_d_MV <- REED_d[NoData_index_KRDU_d,]
# 
# 
# # Filling missing values in KRDU_d by KTTA_d1 data
# KRDU_d_temp <- KRDU_d
# KRDU_d_temp[NoData_index_KRDU_d,2] <- KTTA_d1[NoData_index_KRDU_d,2]
# 
# ## Missing rows
# NoData_index_KRDU_d <- which(is.na(KRDU_d[,2]))
# NoData_index_KRDU_d_temp <- which(is.na(KRDU_d_temp[,2]))
# 
# # Filling missing values in KRDU_d by REED_d data
# KRDU_d_temp[NoData_index_KRDU_d_temp,2] <- REED_d[NoData_index_KRDU_d_temp,2]
# 
# ## Remaining Missing rows
# NoData_index_KRDU_d_temp1 <- which(is.na(KRDU_d_temp[,2]))

# Interpolating the remaining missing values
KRDU_d_temp <- KRDU_d
KRDU_d_temp$AvgDailyTemp_C_KRDU <- na_interpolation(KRDU_d_temp$AvgDailyTemp_C_KRDU, option = "spline")

# Remaining Missing rows (should be 0 now)
NoData_index_KRDU_d_temp2 <- which(is.na(KRDU_d_temp[,2]))


# Adding days, months and year column
KRDU_d_temp <- KRDU_d_temp %>% mutate(Mo = as.numeric(sapply(str_split(KRDU_d_temp$Date, "-"),`[`,2)) , Yr = as.numeric(sapply(str_split(KRDU_d_temp$Date, "-"),`[`,1)) , Day = as.numeric(sapply(str_split(KRDU_d_temp$Date, "-"),`[`,3)))

# Adding n day moving averages to the air temperature data
KRDU_d_temp <- KRDU_d_temp %>% mutate(day7_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 7, fill = NA, align = "right"),
 day14_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 14, fill = NA, align = "right"), 
 day21_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 21, fill = NA, align = "right"),
 day28_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 28, fill = NA, align = "right"),
 day30_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 30, fill = NA, align = "right"),
 day35_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 35, fill = NA, align = "right"),
 day42_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 42, fill = NA, align = "right"),
 day49_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 49, fill = NA, align = "right"),
 day56_ma = rollmean(KRDU_d_temp$AvgDailyTemp_C_KRDU, 56, fill = NA, align = "right")
 )

# Creating a copy of KRDU_d_temp 
KRDU_d_temp1 <- KRDU_d_temp
KRDU_d_temp <- KRDU_d_temp[-c(which(KRDU_d_temp$Yr==1982),which(KRDU_d_temp$Yr==2019)),]


# Quick view of the data
RDKDRU_d

# Quick visualization of missing data
ggplot(data = KRDU_d_temp)+
  geom_point(aes(x = Date, y = AvgDailyTemp_C_KRDU), size = 0.2)+
  geom_line(data = KRDU_d_temp, aes(x = Date, y = AvgDailyTemp_C_KRDU), color = "green", size = 1)+
  geom_point(data = KRDU_d_temp[NoData_index_KRDU_d,], aes(x = Date,AvgDailyTemp_C_KRDU), color = "red")+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
```
## Water Temperature
Now, let us load the water temperature observed in the hypolimnion. We assumed in the model that the depth of the thermocline is about 3 m. So to ascertain that the measured temperature data belonged to the hypolimnion, we kept only those observed temperature values that were measured at depths 4m or greater.

```{r Wtr Temp 1, echo=TRUE, message=FALSE, warning=FALSE}
# loading the original water temp data file
Wtr_raw <- read.csv("DataFiles/Water_temp.csv")

# Cleaning up the data
Wtr_temp <- Wtr_raw

## Arranging the by date, time and depth
Wtr_temp$ActivityStartDate <- as.Date(Wtr_temp$ActivityStartDate, format = "%m/%d/%Y")
Wtr_temp <- Wtr_temp[order(Wtr_temp$ActivityStartDate, Wtr_temp$ActivityStartTime.Time, Wtr_temp$ActivityDepthHeightMeasure.MeasureValue),]

## Reducing columns from the data frame
Wtr_temp <- Wtr_temp[, c(1,2,3,4,5,7, 8,13,14,
                         22,32, 34, 35, 39)]

## There is redundant data: same records with different units of temperature. Removing records with degree F
Wtr_temp <- Wtr_temp[which(Wtr_temp$ResultMeasure.MeasureUnitCode!='deg F'),]

## Changing the units of depth from ft to m
Wtr_temp$ActivityDepthHeightMeasure.MeasureValue[which(Wtr_temp$ActivityDepthHeightMeasure.MeasureUnitCode=='ft')] <- Wtr_temp$ActivityDepthHeightMeasure.MeasureValue[which(Wtr_temp$ActivityDepthHeightMeasure.MeasureUnitCode=='ft')] * 0.3048
Wtr_temp$ActivityDepthHeightMeasure.MeasureUnitCode <- 'm'

# Grouping the data by date and time for depth greater than 4 m
Wtr_temp_summ1 <- Wtr_temp[which(Wtr_temp$ActivityDepthHeightMeasure.MeasureValue>4),]%>%
  group_by(ActivityStartDate) %>%
  summarise(depth_m = mean(ActivityDepthHeightMeasure.MeasureValue),
            Temp_C = mean(ResultMeasureValue))

# Quick visualization of the data cleaned so far
ggplot(data = Wtr_temp_summ1)+
  geom_point(aes(x = ActivityStartDate, y = Temp_C))+
  geom_line(aes(x = ActivityStartDate, y = Temp_C))

# Adding months and years column
Wtr_temp_summ1 <- Wtr_temp_summ1  %>% mutate(Mo = as.numeric(sapply(str_split(Wtr_temp_summ1$ActivityStartDate, "-"),`[`,2)) , Yr = as.numeric(sapply(str_split(Wtr_temp_summ1$ActivityStartDate, "-"),`[`,1)))

# Some months have multiple records in a year. Taking average of those values
# Wtr_temp_summ1 <- Wtr_temp_summ1 %>% group_by(Yr, Mo) %>%
#   summarise(depth_m = mean(depth_m),
#             Temp_C = mean(Temp_C))

# Renaming Date and concentration data column
Wtr_temp_summ1 <- Wtr_temp_summ1 %>% rename(Date = ActivityStartDate,
                                            AvgWaterTemp_C = Temp_C)



# Merging the air and water temperature data
KRDU_d_temp$Date <- as.Date(KRDU_d_temp$Date, format = "%Y-%m-%d")
JL_Temp <- merge(KRDU_d_temp, Wtr_temp_summ1[,c(1,3)], by = "Date", all.x = T)

# To build the regression model, keep rows that have water temperature
Wtr_regrssn <- JL_Temp[-c(13,which(is.na(JL_Temp$AvgWaterTemp_C))),]
```

## Regressional model
Let us develop a regression model to predict the bottom water temperature from air temperature. Generally, bottom water temperature follows air temperature but its variations are relatively suppressed. 

```{r Water Regression model 1, echo=TRUE, message=FALSE, warning=FALSE}
# Linear regression model with 35 day ma
WtrTemp_r_35d <- lm(AvgWaterTemp_C ~ day35_ma, data = Wtr_regrssn)
summary(WtrTemp_r_35d)

## Plotting the regression line
Wtr_regrssn <- Wtr_regrssn %>% mutate(
  ### Hard coding the formula directly
  AvgWtrTemp_35r_c_man = 0.89*day35_ma+2.58,
  ### Using model to predict the values
                                      AvgWtrTemp_35r_c = predict(WtrTemp_r_35d,newdata = .))

### Coefficient of determination
r2_35d <- VarExp(Wtr_regrssn[,"day35_ma"],Wtr_regrssn[,"AvgWaterTemp_C"])
r2_mod <- VarExp(Wtr_regrssn [,"AvgWtrTemp_35r_c"],Wtr_regrssn [,"AvgWaterTemp_C"])

# Quick plot of the 
plot_35d <- ggplot(Wtr_regrssn)+
  geom_point(aes(y = AvgWaterTemp_C, x = day35_ma))+
  theme_classic()+
  labs(title = "Water temp vs 35 days moving average daily air temp",
       subtitle = bquote(R^2~"="~.(r2_35d)),
       y = "Average water temp at depth > 4m (deg. C)",
       x = "35 days moving average air temp (deg. C)")+
  geom_abline(intercept = 0, slope = 1)
plot_35d + geom_abline(aes(intercept = 0, slope = 1), color = "red", lwd = 2)+
  geom_point(data = Wtr_regrssn, aes(x = AvgWaterTemp_C, y = AvgWtrTemp_35r_c), color = "blue")


```

## Regression plots
```{r Regression plot 1, echo=TRUE, message=FALSE, warning=FALSE}
Wtr_reg_plot <- plot_basics+
  geom_point(data = Wtr_regrssn, aes(y = AvgWaterTemp_C, x = day35_ma), color = "blue")+
  geom_point(data = Wtr_regrssn, aes(x = AvgWaterTemp_C, y = AvgWtrTemp_35r_c), color = "red")+
  theme(aspect.ratio = 1,
        axis.text = element_text(color="black", size = 10),
        axis.ticks = element_line(color = "black"))+
  geom_abline(slope = 1, intercept = 0)+
  xlim(0,30)+
  ylim(0,30)+
  geom_text(aes(x = 5, y = 23), label = expression(R^2~"="~0.94), color = "red")+
  geom_text(aes(x = 5, y = 25), label = expression(R^2~"="~0.92), color = "blue")+
  labs (x = expression(atop(Predicted~water~temperature~and,5-week~moving~average~air~temperature~("\u00B0"*C))),
        y = expression(Observed~water~temperature~("\u00B0"*C)))

Wtr_reg_plot

# Saving the plot
# png(file="OutputFiles/JLPMv016_WtrTemp_ScatterPlot.png",height=3,width= 3.5,units='in',res=1200)
# Wtr_reg_plot
# dev.off()
```

```{r Regression plot 2, echo=TRUE, message=FALSE, warning=FALSE}
# Developing daily water temperature based on 35 days moving average
WtrTmp_sim35d <- KRDU_d_temp %>% mutate(WtrTemp_35d_m = 0.89*day35_ma+2.58,
                                        WtrTemp_35d = predict(WtrTemp_r_35d,newdata = .))


## Quick plot
Wtr_reg_plot2 <- plot_basics+
  geom_point(data = WtrTmp_sim35d,
             aes(x = Date, y = WtrTemp_35d, color = "Predicted water temp"), 
             size = 0.2, 
             show.legend = F)+
  geom_point(data = Wtr_regrssn, 
             aes(x = Date, y = AvgWaterTemp_C, color = "Observed water temp"), 
             size = 1,
             show.legend = F)+
  scale_color_manual(values = c(`Predicted water temp` = "red",
                                `Observed water temp` = "black"))+
  theme(aspect.ratio = 0.5,
        axis.text = element_text(color="black", size = 12),
        axis.ticks = element_line(color = "black"))+
  scale_x_date(breaks = as.Date(c("1983-01-01","1990-01-01", "2000-01-01", "2010-01-01", "2018-01-01" ), format = "%Y-%m-%d"),
               # labels = c("1983", "1990", "2000", "2010", "2018"))+
               labels = c("1983-01-01","1990-01-01", "2000-01-01", "2010-01-01", "2018-01-01"))+
  labs(x = "Date",
       y = expression(Water~temperature~at~depth~"\u2265"~4~m~("\u00B0"*C)))
  
Wtr_reg_plot2
  
# Saving the plot
# png(file="OutputFiles/JLPMv016_WtrTemp_RgrssnPlot.png",height=4,width=6,units='in',res=1200)
# Wtr_reg_plot2
# dev.off()

```

# Future temperature projections
The dataset is obtained from https://gdo-dcp.ucllnl.org/downscaled_cmip_projections/dcpInterface.html#Welcome using CMIP5 models and LOCA for downscaling. RCP4.5 and RCP8.5 scenario are considered here and time period = 1980-2090


## RCP4.5
### Minimum daily surface air temperature projections

```{r min RCP4.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Minimum temperature projection for RCP4.5 for 1980-2050
## loding the data file
MinT_45_raw1 <- read.csv("DataFiles/Loca_Temp_min_45.csv", header = TRUE)

## Adding date and median temperature column for quick plot
MinT_45_1 <- MinT_45_raw1 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MinT_45_raw1[,c(4:35)], 1, median))


# Minimum temperature projection for RCP4.5 for 2051-2099
## loding the data file
MinT_45_raw2 <- read.csv("DataFiles/Loca_Temp_min_45_20512099.csv", header = FALSE)

## Adding column names
colnames(MinT_45_raw2) <- c("Year", "Month", "Day", paste0("Temp",c(1:32))) 

## Adding date and median temperature column for quick plot
MinT_45_2 <- MinT_45_raw2 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MinT_45_raw2[,c(4:35)], 1, median))

# Combined Dataset
MinT_45 <- rbind(MinT_45_1,MinT_45_2)


# Quick plos of median daily air temperature
plot(MinT_45_1$Date, MinT_45_1$MedianT, title(main = "Min. temp projections under RCP 4.5 (1980-2050)"), xlab = "Years", ylab = "Median min. temp. (deg. C)")
plot(MinT_45_2$Date, MinT_45_2$MedianT, title(main = "Min. temp projections under RCP 4.5 (1951-2099)"), xlab = "Years", ylab = "Median min. temp. (deg. C)")
plot(MinT_45$Date, MinT_45$MedianT, title(main = "Min. temp projections under RCP 4.5 (1980-2099)"), xlab = "Years", ylab = "Median min. temp. (deg. C)")

```

### Maximum daily surface temperature projections
```{r max RCP4.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Maximum temperature projection for RCP4.5 for 1980-2050
## loading Loca_Temp_max_45.csv data file
MaxT_45_raw1 <- read.csv("DataFiles/Loca_Temp_max_45.csv", header = TRUE)

## Adding date and median temperature column for quick plot
MaxT_45_1 <- MaxT_45_raw1 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MaxT_45_raw1[,c(4:35)], 1, median))

# Maximum temperature projection for RCP4.5 for 2051-2099
## loading Loca_Temp_max_45_20512099.csv data file
MaxT_45_raw2 <- read.csv("DataFiles/Loca_Temp_max_45_20512099.csv", header = FALSE)

## Adding column names
colnames(MaxT_45_raw2) <- c("Year", "Month", "Day", paste0("Temp",c(1:32))) 

# Adding date and median temperature column for quick plot
MaxT_45_2 <- MaxT_45_raw2 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MaxT_45_raw2[,c(4:35)], 1, median))

# Combined Dataset
MaxT_45 <- rbind(MaxT_45_1,MaxT_45_2)

# Quick plot of median daily air temperature
plot(MaxT_45_1$Date, MaxT_45_1$MedianT, xlab = "Years", ylab = "Median max. temp. (deg. C)")
plot(MaxT_45_2$Date, MaxT_45_2$MedianT, xlab = "Years", ylab = "Median max. temp. (deg. C)")
plot(MaxT_45$Date, MaxT_45$MedianT, xlab = "Years", ylab = "Median max. temp. (deg. C)")
```

### Average daily air temperature projections 
As average daily air temperature was not available, average of minimum and maximum of each day was taken for each model as substitute. 

```{r avg RCP4.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Average daily air temperature
## Combining min and max air temperature to create avg air temp
AvgT_45 <- bind_rows(MinT_45, MaxT_45) %>%
  group_by(Date) %>%
  summarise_all(list(mean))

## Average monthly air temperature
AvgT_45_mo <- AvgT_45 %>%
  group_by(Year,Month) %>%
  summarise_at(vars(c(Temp1:Temp32)), funs(mean))%>% 
  mutate(Art_date = as.Date(paste0(Year,"/",Month, "/01")))

## Average annual air temperature
AvgT_45_yr <- AvgT_45 %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)), funs(mean))

AvgT_45_yr <- AvgT_45_yr %>%
  mutate(MedianT = apply(AvgT_45_yr[,c(2:33)], 1, median),
         MedianT_F = MedianT*(9/5)+32)

# 35 day moving average air temperature
## Daily moving average
AvgT_45_35ma_daily <- cbind(AvgT_45[,c(1:4)],
                            apply(AvgT_45[,paste0("Temp",c(1:32))],2,ma35_calc)) %>%
  drop_na()


## Monthly moving average
AvgT_45_35ma_mo <- AvgT_45_35ma_daily %>%
  group_by(Year,Month) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA = mean)) %>%
  mutate(Art_date = as.Date(paste0(Year,"/",Month, "/01")))

## Annual moving average
AvgT_45_35ma_year <- AvgT_45_35ma_daily %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA = mean))

AvgT_45_35ma_year <- AvgT_45_35ma_year %>%
  mutate(MedianT = apply(AvgT_45_35ma_year[,c(2:33)], 1, median),
         MedianT_F = MedianT*(9/5)+32,
         MaxT_F = apply(AvgT_45_35ma_year[,c(2:33)], 1, max)*(9/5)+32,
         MinT_F = apply(AvgT_45_35ma_year[,c(2:33)], 1, min)*(9/5)+32)


# Plots
## Quick plot of monthly variations of some of the models
plot(AvgT_45_mo$Art_date[1000:1024], AvgT_45_mo$Temp1[1000:1024], ylim= c(0,40), title(main = "Monthly variation in 3 GCM temp projections \n under RCP 4.5"), xlab = "Year", ylab = "Monthly avg. temp. (deg. C)")
points(AvgT_45_mo$Art_date[1000:1024], AvgT_45_mo$Temp2[1000:1024], col = "red")
points(AvgT_45_mo$Art_date[1000:1024], AvgT_45_mo$Temp3[1000:1024], col = "blue")
legend("topright", col = c("black", "red", "blue"),
       lwd = 2, legend = c("Model 1","Model 2", "Model 3"))


# Annual average air temperature
plot(AvgT_45_yr$Year, AvgT_45_yr$MedianT, title(main = "Annual temp projections (1980-2099)"), xlab = "Year", ylab = "Annual avg. temp. (deg. C)")
plot(AvgT_45_35ma_year$Year, AvgT_45_35ma_year$MedianT, title(main = "Annual 35day moving avg temp projections (1980-2099)"), xlab = "Year", ylab = "Annual avg. temp. (deg. C)")


```

## RCP8.5
### Minimum daily surface air temperature projections

```{r min RCP8.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Minimum temperature projection for RCP8.5 for 1980-2050
## loading the Loca_Temp_min_85.csv data file
MinT_85_raw1 <- read.csv("DataFiles/Loca_Temp_min_85.csv", header = TRUE)

## Adding date and median temperature column for quick plot
MinT_85_1 <- MinT_85_raw1 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MinT_85_raw1[,c(4:35)], 1, median))


# Minimum temperature projection for RCP8.5 for 2051-2099
MinT_85_raw2 <- read.csv("DataFiles/Loca_Temp_min_85_20512099.csv", header = FALSE)

## Adding column names
colnames(MinT_85_raw2) <- c("Year", "Month", "Day", paste0("Temp",c(1:32))) 

## Ensuring all the columns are numeric
MinT_85_raw2[,paste0("Temp",c(1:32))] <- apply(MinT_85_raw2[,paste0("Temp",c(1:32))], 2, as.numeric)

## Adding date and median temperature column for quick plot
MinT_85_2 <- MinT_85_raw2 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MinT_85_raw2[,c(4:35)], 1, median))


# combining the two data frames
MinT_85 <- rbind(MinT_85_1,MinT_85_2)


# Quick plot of median daily air temperature
plot(MinT_85_1$Date, MinT_85_1$MedianT, title(main = "Min. temp projections under RCP 8.5 (1980-2050)"), xlab = "Year", ylab = "Median min. temp. (deg. C)")
plot(MinT_85_2$Date, MinT_85_2$MedianT, title(main = "Min. temp projections under RCP 8.5 (1951-2099)"), xlab = "Year", ylab = "Median min. temp. (deg. C)")
plot(MinT_85$Date, MinT_85$MedianT, title(main = "Min. temp projections under RCP 8.5 (1980-2099)"), xlab = "Year", ylab = "Median min. temp. (deg. C)")


```

### Maximum daily surface temperature projections
```{r max RCP8.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Maximum temperature projection for RCP4.5 for 1980-2050
## loading Loca_Temp_max_85.csv
MaxT_85_raw1 <- read.csv("DataFiles/Loca_Temp_max_85.csv", header = TRUE)

## Adding date and median temperature column for quick plot
MaxT_85_1 <- MaxT_85_raw1 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MaxT_85_raw1[,c(4:35)], 1, median))

# Maximum temperature projection for RCP4.5 for 2051-2099
## loading Loca_Temp_max_85_20512099.csv
MaxT_85_raw2 <- read.csv("DataFiles/Loca_Temp_max_85_20512099.csv", header = FALSE)

## Adding column names
colnames(MaxT_85_raw2) <- c("Year", "Month", "Day", paste0("Temp",c(1:32))) 

## Ensuring all the columns are numeric
MaxT_85_raw2[,paste0("Temp",c(1:32))] <- apply(MaxT_85_raw2[,paste0("Temp",c(1:32))], 2, as.numeric)

## Adding date and median temperature column for quick plot
MaxT_85_2 <- MaxT_85_raw2 %>% 
  mutate(Date = as.Date(paste0(Year,"/",Month,"/",Day)),
         MedianT = apply(MaxT_85_raw2[,c(4:35)], 1, median))


# combining the two data frames
MaxT_85 <- rbind(MaxT_85_1,MaxT_85_2)


# Quick plot of median daily air temperature
plot(MaxT_85_1$Date, MaxT_85_1$MedianT, title(main = "Max. temp projections under RCP 8.5 (1980-2050)"), xlab = "Year", ylab = "Median max. temp. (deg. C)")
plot(MaxT_85_2$Date, MaxT_85_2$MedianT, title(main = "Max. temp projections under RCP 8.5 (1951-2099)"), xlab = "Year", ylab = "Median max. temp. (deg. C)")
plot(MaxT_85$Date, MaxT_85$MedianT, title(main = "Max. temp projections under RCP 8.5 (1980-2099)"), xlab = "Year", ylab = "Median max. temp. (deg. C)")
```

### Average daily air temperature projections 
As averae daily air temperature was not available, average of minimum and maximum of each day was taken for each model as substitute. 

```{r avg RCP8.5 air temp, echo=TRUE, message=FALSE, warning=FALSE}
# Average daily air temperature
AvgT_85 <- bind_rows(MinT_85, MaxT_85) %>%
  group_by(Date) %>%
  summarise_all(list(mean))

# Average monthly air temperature
AvgT_85_mo <- AvgT_85 %>%
  group_by(Year,Month) %>%
  summarise_at(vars(c(Temp1:Temp32)), funs(mean))%>% 
  mutate(Art_date = as.Date(paste0(Year,"/",Month, "/01")))

# annual average daily air temperature
AvgT_85_yr <- AvgT_85 %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)), funs(mean))

AvgT_85_yr <- AvgT_85_yr %>%
  mutate(MedianT = apply(AvgT_85_yr[,c(2:33)], 1, median),
         MedianT_F = MedianT*(9/5)+32)

# 35 day moving average air temperature
# Daily moving average
AvgT_85_35ma_daily <- cbind(AvgT_85[,c(1:4)],
                            apply(AvgT_85[,paste0("Temp",c(1:32))],2,ma35_calc)) %>%
  drop_na()


# Monthly moving average
AvgT_85_35ma_mo <- AvgT_85_35ma_daily %>%
  group_by(Year,Month) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA = mean)) %>%
  mutate(Art_date = as.Date(paste0(Year,"/",Month, "/01")))

# Annual moving average
AvgT_85_35ma_year <- AvgT_85_35ma_daily %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA = mean))

AvgT_85_35ma_year <- AvgT_85_35ma_year %>%
  mutate(MedianT = apply(AvgT_85_35ma_year[,c(2:33)], 1, median),
         MedianT_F = MedianT*(9/5)+32,
         MaxT_F = apply(AvgT_85_35ma_year[,c(2:33)], 1, max)*(9/5)+32,
         MinT_F = apply(AvgT_85_35ma_year[,c(2:33)], 1, min)*(9/5)+32)

# Plots
# Quick plot of monthly variations of some of the models
plot(AvgT_85_mo$Art_date[1000:1024], AvgT_85_mo$Temp1[1000:1024], ylim= c(0,40), title(main = "Monthly variation in 3 GCM temp projections \n under RCP 8.5"), xlab = "Year", ylab = "Monthly avg. temp. (deg. C)")
points(AvgT_85_mo$Art_date[1000:1024], AvgT_85_mo$Temp2[1000:1024], col = "red")
points(AvgT_85_mo$Art_date[1000:1024], AvgT_85_mo$Temp3[1000:1024], col = "blue")
legend("topright", col = c("black", "red", "blue"),
       lwd = 2, legend = c("Model 1","Model 2", "Model 3"))


# Annual average air temperature in fahrenheit
plot(AvgT_85_yr$Year, AvgT_85_yr$MedianT, title(main = "Annual temp projections (1980-2099) under RCP 8.5"), xlab = "Year", ylab = "Annual avg. temp. (deg. C)")
plot(AvgT_85_35ma_year$Year, AvgT_85_35ma_year$MedianT, title(main = "Annual 35day moving avg temp projections (1980-2099) under RCP 8.5"), xlab = "Year", ylab = "Annual avg. temp. (deg. C)")
```

## Combined plot
```{r CombinedPlot1, echo=TRUE, message=FALSE, warning=FALSE}
# RCP4.5
AvgT_45_yr_PI <- apply(AvgT_45_yr[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>% 
  t %>% 
  as.data.frame() %>% 
  mutate(Year = seq(1980, 2099))
AvgT_45_yr_PI <-AvgT_45_yr_PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(AvgT_45_yr_PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(AvgT_45_yr_PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(AvgT_45_yr_PI[, "97.5%"], 10)) %>%
  drop_na()


# RCP8.5
## Removing NA values
AvgT_85_yr_PI <- AvgT_85_yr %>% drop_na() 
AvgT_85_yr_PI <- apply(AvgT_85_yr_PI[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>% 
  t %>% 
  as.data.frame() %>% 
  mutate(Year = seq(1980, 2098))
AvgT_85_yr_PI <-AvgT_85_yr_PI[,c(4,1:3)]%>% mutate(`2.5%_10ma` = ma_calc(AvgT_85_yr_PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(AvgT_85_yr_PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(AvgT_85_yr_PI[, "97.5%"], 10)) %>%
  drop_na()

# Combined plot
ComAirTempProj_plot <- plot_basics+
  # geom_line(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year >= 2018 & AvgT_45_yr_PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year >= 2018 & AvgT_45_yr_PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = AvgT_85_yr_PI[which(AvgT_85_yr_PI$Year >= 2018 & AvgT_85_yr_PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = AvgT_85_yr_PI[which(AvgT_85_yr_PI$Year >= 2018 & AvgT_85_yr_PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year <= 2018),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2018, lty = 3)+
  labs(x = "Year",
       y = expression(Average~air~temperature~"("*degree*C*")"))+
  # labs(x = "",
  #      y = "")+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(12,25),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        # legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        # axis.text = element_blank(),
        # axis.title = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))

ComAirTempProj_plot

# Saving the plot
# png(file="OutputFiles/JLPMv016_ComAirTempProj_plot.png",width = 6, height = 4, units = 'in', res = 1200)
# ComAirTempProj_plot
# dev.off()

```

## Water temperature Projections
```{r WaterTempProj1, echo=TRUE, message=FALSE, warning=FALSE}
# Monthly bottom water temperature based on RCP4.5
AvgT_45_wtrTempProj_daily <- AvgT_45_35ma_daily 
AvgT_45_wtrTempProj_daily[,5:36] <- apply(AvgT_45_wtrTempProj_daily[,5:36], 2, WtrRegMod)

# Monthly bottom water temperature temperature
AvgT_45_wtrTempProj_mo <- AvgT_45_wtrTempProj_daily %>%
  group_by(Year, Month) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA_W = mean))

# Annual bottom water temperature temperature
AvgT_45_wtrTempProj_year <- AvgT_45_wtrTempProj_daily %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA_W = mean))

# Monthly bottom water temperature based on RCP8.5
# Carrying out the linear regression
AvgT_85_wtrTempProj_daily <- AvgT_85_35ma_daily 
AvgT_85_wtrTempProj_daily[,5:36] <-  apply(AvgT_85_wtrTempProj_daily[,5:36], 2, WtrRegMod)

# Monthly bottom water temperature temperature
AvgT_85_wtrTempProj_mo <- AvgT_85_wtrTempProj_daily %>%
  group_by(Year, Month) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA_W = mean))

# Annual bottom water temperature temperature
AvgT_85_wtrTempProj_year <- AvgT_85_wtrTempProj_daily %>%
  group_by(Year) %>% 
  summarise_at(vars(c(Temp1:Temp32)),
               funs(MA_W = mean))

# RCP4.5
AvgT_45_wtrTempProj_year.PI <- apply(AvgT_45_wtrTempProj_year[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>% 
  t %>% 
  as.data.frame() %>% 
  mutate(Year = seq(1980, 2099))
AvgT_45_wtrTempProj_year.PI <-AvgT_45_wtrTempProj_year.PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(AvgT_45_wtrTempProj_year.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(AvgT_45_wtrTempProj_year.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(AvgT_45_wtrTempProj_year.PI[, "97.5%"], 10)) %>%
  drop_na()


# RCP8.5
## Removing NA values
AvgT_85_wtrTempProj_year.PI <- AvgT_85_wtrTempProj_year %>% drop_na() 
AvgT_85_wtrTempProj_year.PI <- apply(AvgT_85_wtrTempProj_year.PI[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>% 
  t %>% 
  as.data.frame() %>% 
  mutate(Year = seq(1980, 2099))
AvgT_85_wtrTempProj_year.PI <-AvgT_85_wtrTempProj_year.PI[,c(4,1:3)]%>% mutate(`2.5%_10ma` = ma_calc(AvgT_85_wtrTempProj_year.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(AvgT_85_wtrTempProj_year.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(AvgT_85_wtrTempProj_year.PI[, "97.5%"], 10)) %>%
  drop_na()

# Combined plot
ComWtrTempProj_plot <- plot_basics+
  # geom_line(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year >= 2018 & AvgT_45_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year >= 2018 & AvgT_45_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = AvgT_85_wtrTempProj_year.PI[which(AvgT_85_wtrTempProj_year.PI$Year >= 2018 & AvgT_85_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = AvgT_85_wtrTempProj_year.PI[which(AvgT_85_wtrTempProj_year.PI$Year >= 2018 & AvgT_85_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year <= 2018),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2018, lty = 3)+
  labs(x = "Year",
       y = expression(Average~bottom~water~temperature~"("*degree*C*")"))+
  # labs(x = "",
  #      y = "")+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(12,25),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        # axis.text = element_blank(),
        # axis.title = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))

ComWtrTempProj_plot

# Saving the plot
# png(file="OutputFiles/JLPMv016_ComWtrTempProj_plot.png",width = 6, height = 4, units = 'in', res = 1200)
# ComWtrTempProj_plot
# dev.off()


```


# Future Evapotranspiration projections
## RCP4.5
```{r ET4.5_1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the Evapo-transpiration projections
## Loading Loca5_ET_45_tot.xlsx 
ET_45_raw1 <- read_excel("DataFiles/Loca5_ET_45_tot.xlsx")

## data tidying
ET_45 <- ET_45_raw1
### Checking for NA
ET_45.isna <- ET_45[which(is.na(ET_45)),] # should be 0 rows

### Checking if all the values are num
ET_45.isnum <- ET_45[which(is.numeric(ET_45)),] # should be 0 rows!

### Adding date to the data frame
ET_45 <- ET_45 %>% mutate(Date = as.Date(paste0(Month,"-",Day,"-",Year), format = "%m-%d-%Y"))

### Rearranging the data frame
ET_45 <- ET_45[,c(36,1,2,4:35)]

### Calculating the median value
ET_45 <- ET_45 %>% mutate(Median_ET = apply(ET_45[,2:33], 1, median))

### Quick plot to visualize the median plot
plot(ET_45$Date, ET_45$Median_ET, title(main = "Median evapotranspiration projections under RCP 4.5"), xlab = "Year", ylab = "Evapotranspiration (mm/day)")

## Average monthly ET projections
ET_45_mo <- ET_45 %>% drop_na() %>% group_by(Year,Month) %>% summarise_at(vars(c(ET1:ET32)), funs(mean)) 

## Average annual ET projections
ET_45_yr <- ET_45 %>% drop_na()  %>% group_by(Year) %>% summarise_at(vars(c(ET1:ET32)), funs(mean)) 

## Getting 95% prediction intervals
ET_45_yr.PI <- apply(ET_45_yr[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>%
  t %>%
  as.data.frame()%>%
  mutate(Year = seq(1980, 2099))

### Adding 10 year moving average
ET_45_yr.PI <-ET_45_yr.PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(ET_45_yr.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(ET_45_yr.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(ET_45_yr.PI[, "97.5%"], 10)) %>%
  drop_na()

# Visualizing the projections with moving average
ET_45_yr_plot <- plot_basics+
  geom_ribbon(data = ET_45_yr.PI[which(ET_45_yr.PI$Year >= 2018 & ET_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ), fill = "red", alpha = 0.2)+
  labs(x = "Year",
       y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  scale_y_continuous(limits = c(1,3),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))
ET_45_yr_plot

```

## RCP8.5
```{r ET8.5_1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the Evapo-transpiration projections
## Loading Loca5_ET_85_tot.xlsx 
ET_85_raw1 <- read_excel("DataFiles/Loca5_ET_85_tot.xlsx")

## data tidying
ET_85 <- ET_85_raw1
### Checking for NA
ET_85.isna <- ET_85[which(is.na(ET_85)),] # should be 1 row

### Checking if all the values are num
ET_85.isnum <- ET_85[which(is.numeric(ET_85)),] # should be 0 rows!

### Adding date to the data frame
ET_85 <- ET_85 %>% mutate(Date = as.Date(paste0(Month,"-",Day,"-",Year), format = "%m-%d-%Y"))

### Rearranging the data frame
ET_85 <- ET_85[,c(36,1,2,4:35)]

### Calculating the median value
ET_85 <- ET_85 %>% mutate(Median_ET = apply(ET_85[,2:33], 1, median))

### Quick plot to visualize the median plot
plot(ET_85$Date, ET_85$Median_ET, title(main = "Median evapotranspiration projections under RCP 8.5"), xlab = "Year", ylab = "Evapotranspiration (mm/day)")

## Average monthly ET projections
ET_85_mo <- ET_85 %>% drop_na() %>% group_by(Year,Month) %>% summarise_at(vars(c(ET1:ET32)), funs(mean)) 

## Average annual ET projections
ET_85_yr <- ET_85 %>% drop_na()  %>% group_by(Year) %>% summarise_at(vars(c(ET1:ET32)), funs(mean)) 

## Getting 95% prediction intervals
ET_85_yr.PI <- apply(ET_85_yr[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>%
  t %>%
  as.data.frame()%>%
  mutate(Year = seq(1980, 2099))

### Adding 10 year moving average
ET_85_yr.PI <-ET_85_yr.PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(ET_85_yr.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(ET_85_yr.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(ET_85_yr.PI[, "97.5%"], 10)) %>%
  drop_na()

# Visualizing the projections with moving average
ET_85_yr_plot <- plot_basics+
  geom_ribbon(data = ET_85_yr.PI[which(ET_85_yr.PI$Year >= 2018 & ET_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ), fill = "red", alpha = 0.2)+
  labs(x = "Year",
       y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  scale_y_continuous(limits = c(1,3),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))
ET_85_yr_plot

```


##Comined plot
```{r ET_combined_plot, echo=TRUE, message=FALSE, warning=FALSE}
# Combined plot
ComETProj_plot <- plot_basics+
  # geom_line(data = ET_45_yr.PI[which(ET_45_yr.PI$Year >= 2018 & ET_45_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = ET_45_yr.PI[which(ET_45_yr.PI$Year >= 2018 & ET_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = ET_85_yr.PI[which(ET_85_yr.PI$Year >= 2018 & ET_85_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = ET_85_yr.PI[which(ET_85_yr.PI$Year >= 2018 & ET_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = ET_45_yr.PI[which(ET_45_yr.PI$Year <= 2018),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2018, lty = 3)+
  labs(x = "Year",
       y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  # labs(x = "",
  #      y = "")+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(1,3),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        # legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        # axis.text = element_blank(),
        # axis.title = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))

ComETProj_plot

# Saving the plot
# png(file="OutputFiles/JLPMv016_ComETProj_plot.png",width = 6, height = 4, units = 'in', res = 1200)
# ComETProj_plot
# dev.off()
```

# Future precipitation projections
## RCP4.5
```{r Prec4.5_1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the Precipitation projections
## Loading Loca5_Prec_45_tot.xlsx 
Prec_45_raw1 <- read_excel("DataFiles/Loca5_Prec_45_tot.xlsx")

## data tidying
Prec_45 <- Prec_45_raw1
### Checking for NA
Prec_45.isna <- Prec_45[which(is.na(Prec_45)),] # should be 0 rows

### Checking if all the values are num
Prec_45.isnum <- Prec_45[which(is.numeric(Prec_45)),] # should be 0 rows!

### Adding date to the data frame
Prec_45 <- Prec_45 %>% mutate(Date = as.Date(paste0(Month,"-",Day,"-",Year), format = "%m-%d-%Y"))

### Rearranging the data frame
Prec_45 <- Prec_45[,c(36,1,2,4:35)]

### Calculating the median value
Prec_45 <- Prec_45 %>% mutate(Median_Prec = apply(Prec_45[,2:33], 1, median))

### Quick plot to visualize the median plot
plot(Prec_45$Date, Prec_45$Median_Prec, title(main = "Median precipitation projections under RCP 4.5"), xlab = "Year", ylab = "precipitation (mm/day)")

## Average monthly Prec projections
Prec_45_mo <- Prec_45 %>% drop_na() %>% group_by(Year,Month) %>% summarise_at(vars(c(Prec1:Prec32)), funs(mean)) 

## Average annual Prec projections
Prec_45_yr <- Prec_45 %>% drop_na()  %>% group_by(Year) %>% summarise_at(vars(c(Prec1:Prec32)), funs(mean)) 

## Getting 95% prediction intervals
Prec_45_yr.PI <- apply(Prec_45_yr[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>%
  t %>%
  as.data.frame()%>%
  mutate(Year = seq(1980, 2099))

### Adding 10 year moving average
Prec_45_yr.PI <-Prec_45_yr.PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(Prec_45_yr.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(Prec_45_yr.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(Prec_45_yr.PI[, "97.5%"], 10)) %>%
  drop_na()

# Visualizing the projections with moving average
Prec_45_yr_plot <- plot_basics+
  geom_ribbon(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year >= 2018 & Prec_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ), fill = "red", alpha = 0.2)+
  labs(x = "Year",
       y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  scale_y_continuous(limits = c(1,5),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))
Prec_45_yr_plot

```

## RCP8.5
```{r Prec8.5_1, echo=TRUE, message=FALSE, warning=FALSE}
# Loading the Precipitation projections
## Loading Loca5_Prec_85_tot.xlsx 
Prec_85_raw1 <- read_excel("DataFiles/Loca5_Prec_85_tot.xlsx")

## data tidying
Prec_85 <- Prec_85_raw1
### Checking for NA
Prec_85.isna <- Prec_85[which(is.na(Prec_85)),] # should be 1 rows

### Checking if all the values are num
Prec_85.isnum <- Prec_85[which(is.numeric(Prec_85)),] # should be 0 rows!

### Adding date to the data frame
Prec_85 <- Prec_85 %>% mutate(Date = as.Date(paste0(Month,"-",Day,"-",Year), format = "%m-%d-%Y"))

### Rearranging the data frame
Prec_85 <- Prec_85[,c(36,1,2,4:35)]

### Calculating the median value
Prec_85 <- Prec_85 %>% mutate(Median_Prec = apply(Prec_85[,2:33], 1, median))

### Quick plot to visualize the median plot
plot(Prec_85$Date, Prec_85$Median_Prec, title(main = "Median precipitation projections under RCP 8.5"), xlab = "Year", ylab = "precipitation (mm/day)")

## Average monthly Prec projections
Prec_85_mo <- Prec_85 %>% drop_na() %>% group_by(Year,Month) %>% summarise_at(vars(c(Prec1:Prec32)), funs(mean)) 

## Average annual Prec projections
Prec_85_yr <- Prec_85 %>% drop_na()  %>% group_by(Year) %>% summarise_at(vars(c(Prec1:Prec32)), funs(mean)) 

## Getting 95% prediction intervals
Prec_85_yr.PI <- apply(Prec_85_yr[,2:33], 1 ,quantile ,probs =c(0.025,.5,.975)) %>%
  t %>%
  as.data.frame()%>%
  mutate(Year = seq(1980, 2099))

### Adding 10 year moving average
Prec_85_yr.PI <-Prec_85_yr.PI[,c(4,1:3)] %>% mutate(`2.5%_10ma` = ma_calc(Prec_85_yr.PI[, "2.5%"], 10),
                                                    `50%_10ma` = ma_calc(Prec_85_yr.PI[, "50%"], 10),
                                                    `97.5%_10ma` = ma_calc(Prec_85_yr.PI[, "97.5%"], 10)) %>%
  drop_na()

# Visualizing the projections with moving average
Prec_85_yr_plot <- plot_basics+
  geom_ribbon(data = Prec_85_yr.PI[which(Prec_85_yr.PI$Year >= 2018 & Prec_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ), fill = "red", alpha = 0.2)+
  labs(x = "Year",
       y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  scale_y_continuous(limits = c(1,5),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))
Prec_85_yr_plot

```


##Comined plot
```{r Prec_combined_plot, echo=TRUE, message=FALSE, warning=FALSE}
# Combined plot
ComPrecProj_plot <- plot_basics+
  # geom_line(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year >= 2018 & Prec_45_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year >= 2018 & Prec_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = Prec_85_yr.PI[which(Prec_85_yr.PI$Year >= 2018 & Prec_85_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = Prec_85_yr.PI[which(Prec_85_yr.PI$Year >= 2018 & Prec_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year <= 2018),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2018, lty = 3)+
  labs(x = "Year",
       y = expression(Average~precipitation~"("*mm/day*")"))+
  # labs(x = "",
  #      y = "")+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(1,5),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2018, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        legend.position = c(0.75,0.15),
        # legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        # axis.text = element_blank(),
        # axis.title = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(1, 1, 0.1, 1, "cm"))

ComPrecProj_plot

# Saving the plot
# png(file="OutputFiles/JLPMv016_ComPrecProj_plot.png",width = 6, height = 4, units = 'in', res = 1200)
# ComPrecProj_plot
# dev.off()
```

## Combined hydroclimatological plot
```{r Combined_TempETPrec_plot, echo=TRUE, message=FALSE, warning=FALSE}
# Replotting the previous plots again
# Combined plot
ComETProj_plot1 <- plot_basics+
  # geom_line(data = ET_45_yr.PI[which(ET_45_yr.PI$Year >= 2019 & ET_45_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = ET_45_yr.PI[which(ET_45_yr.PI$Year >= 2019 & ET_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = ET_85_yr.PI[which(ET_85_yr.PI$Year >= 2019 & ET_85_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = ET_85_yr.PI[which(ET_85_yr.PI$Year >= 2019 & ET_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = ET_45_yr.PI[which(ET_45_yr.PI$Year <= 2019),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2019, lty = 3)+
  # labs(x = "Year",
  #      y = expression(Average~evapotranspiration~"("*mm/day*")"))+
  labs(x = "",
       y = expression(atop(Avg.~ET,"("*mm/day*")")))+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(1,3),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2019, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        # legend.position = c(0.65,0.85),
        legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(0.25, 1, 0.25, 0, "cm"))

# ComETProj_plot1

ComPrecProj_plot1 <- plot_basics+
  # geom_line(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year >= 2019 & Prec_45_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year >= 2019 & Prec_45_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = Prec_85_yr.PI[which(Prec_85_yr.PI$Year >= 2019 & Prec_85_yr.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = Prec_85_yr.PI[which(Prec_85_yr.PI$Year >= 2019 & Prec_85_yr.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = Prec_45_yr.PI[which(Prec_45_yr.PI$Year <= 2019),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2019, lty = 3)+
  # labs(x = "Year",
  #      y = expression(Average~precipitation~"("*mm/day*")"))+
  labs(x = "",
       y = expression(atop(Avg.~prec.,"("*mm/day*")")))+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(1,5),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2019, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        # legend.position = c(0.75,0.15),
        legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(0.25, 1, 0.25, 0, "cm"))

# ComPrecProj_plot1

ComAirTempProj_plot1 <- plot_basics+
  # geom_line(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year >= 2019 & AvgT_45_yr_PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year >= 2019 & AvgT_45_yr_PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = AvgT_85_yr_PI[which(AvgT_85_yr_PI$Year >= 2019 & AvgT_85_yr_PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = AvgT_85_yr_PI[which(AvgT_85_yr_PI$Year >= 2019 & AvgT_85_yr_PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = AvgT_45_yr_PI[which(AvgT_45_yr_PI$Year <= 2019),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2019, lty = 3)+
  # labs(x = "Year",
  #      y = expression(Average~air~temperature~"("*degree*C*")"))+
  labs(x = "",
       y = expression(atop(Avg.~air,temp~"("*"\u00B0"*C*")")))+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(12,25),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2019, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        # legend.position = c(0.65,0.85),
        legend.position = "none",
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(0.25, 1, 0.25, 0, "cm"))

# ComAirTempProj_plot1

ComWtrTempProj_plot1 <- plot_basics+
  # geom_line(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year >= 2019 & AvgT_45_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 4.5"), size = 0.5)+
  geom_ribbon(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year >= 2019 & AvgT_45_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 4.5"), alpha = 0.2)+
  # geom_line(data = AvgT_85_wtrTempProj_year.PI[which(AvgT_85_wtrTempProj_year.PI$Year >= 2019 & AvgT_85_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, y = `50%_10ma`, color = "RCP 8.5"), size = 0.5)+
  geom_ribbon(data = AvgT_85_wtrTempProj_year.PI[which(AvgT_85_wtrTempProj_year.PI$Year >= 2019 & AvgT_85_wtrTempProj_year.PI$Year <= 2090),], aes(x = Year, ymin = `2.5%_10ma`, ymax = `97.5%_10ma` ,fill = "RCP 8.5"), alpha = 0.2)+
  # geom_line(data = AvgT_45_wtrTempProj_year.PI[which(AvgT_45_wtrTempProj_year.PI$Year <= 2019),], aes(x = Year, y = `50%_10ma`, color = "Observed"), size = 0.5)+
  # geom_vline(xintercept = 2019, lty = 3)+
  # labs(x = "Year",
  #      y = expression(Average~bottom~water~temperature~"("*degree*C*")"))+
  labs(x = "",
       y = expression(atop(Avg.~bottom~water,temp~"("*"\u00B0"*C*")")))+
  scale_color_manual(values = c(`Observed` = "black",
                                `RCP 4.5` = "blue",
                                `RCP 8.5` = "red"),
                     guide = guide_legend(override.aes = list(size = c(1,1,1),
                                                              shape = c(NA,NA,NA),
                                                              lty = c(1,1,1))))+
  scale_fill_manual(values = c(`RCP 4.5` = "blue",
                               `RCP 8.5` = "red"),
                    label = c("RCP 4.5", "RCP 8.5"),
                    guide = guide_legend(override.aes = list(alpha = c(0.1,0.1))))+
  scale_y_continuous(limits = c(12,25),expand = c(0, 0))+
  scale_x_continuous(breaks = c(2019, 2030, 2050, 2070, 2090),expand = c(0, 0))+
  theme(legend.title = element_blank(),
        plot.margin = unit(c(5,12,5,5), "points"),
        legend.position = c(0.65,0.85),
        legend.direction = "horizontal",
        legend.text = element_text(size = 12, color = "black"),
        # axis.text = element_blank(),
        axis.title.x = element_blank(),
        axis.text = element_text(size = 12, color = "black"),
        axis.title = element_text(size = 12, color = "black"),
        axis.ticks = element_line(color = "black"))
        # plot.margin = margin(0.25, 1, 0, 0, "cm"))

# ComWtrTempProj_plot1



# 
# gridtext
yleft <- textGrob("",
                  rot = 90, gp = gpar(fontsize = 12))

yright <- textGrob(expression(P~"in"~sediments~(g/m^2)),
                   rot = 270, gp = gpar(fontsize = 12))

bottom <- textGrob("Years", gp = gpar(fontsize = 12, col="black"))

TeETPr_plot <- { 
  wrap_elements(yleft) +
    {{ComETProj_plot1 / ComPrecProj_plot1 / ComAirTempProj_plot1 / ComWtrTempProj_plot1}}  +
    # wrap_elements(yright) +
    plot_layout(widths=c(.1,18)) } /
  bottom +
  plot_layout(heights=c(98,4))

TeETPr_plot

# Saving the plot
# ggsave("OutputFiles/JLPMv016_ComProj_plot.png",TeETPr_plot,
#        height=6,width=6,units='in',dpi=1200)
# dev.off()

```

# Saving the workspace
```{r Saving the workspace, echo=TRUE, message=FALSE, warning=FALSE}
# Saving the file
## [04-30-2023]
# save.image("RWorkSpaces/JLPMv016p009_1.RData")

```






```{r echo=TRUE, message=FALSE, warning=FALSE}
# Start timer
End_timer9 <- Sys.time()

# Total time taken to run the entire notebook
Tot_time9 <- End_timer9 - Start_timer9
Tot_time9
```